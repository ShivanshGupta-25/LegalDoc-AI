{% extends "base.html" %}
{% block content %}

<!-- Custom Styling -->
<style>
  .section-title {
    font-weight: 700;
    font-size: 1.5rem;
    color: #1e293b;
    margin-top: 40px;
    margin-bottom: 20px;
  }

  .emoji {
    font-size: 1.6rem;
    margin-right: 6px;
  }

  .card-box {
    background-color: #ffffff;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
    animation: fadeIn 0.8s ease-in-out;
  }

  .scroll-box {
    max-height: 240px;
    overflow-y: auto;
    background-color: #f8fafc;
    border-radius: 12px;
    padding: 15px;
    border: 1px solid #e2e8f0;
    font-family: 'Courier New', Courier, monospace;
  }

  #chatbox {
    height: 320px;
    overflow-y: auto;
    background-color: #f1f5f9;
    padding: 15px;
    border-radius: 12px;
    border: 1px solid #cbd5e1;
    font-size: 0.95rem;
  }

  .user-msg,
  .ai-msg,
  .error-msg,
  .thinking-msg {
    margin-bottom: 12px;
    padding: 12px 16px;
    border-radius: 12px;
    animation: slideIn 0.3s ease forwards;
  }

  .user-msg {
    background: #3b82f6;
    color: #ffffff;
  }

  .ai-msg {
    background: #10b981;
    color: #ffffff;
  }

  .thinking-msg {
    background: #e2e8f0;
    color: #334155;
    font-style: italic;
  }

  .error-msg {
    background: #ef4444;
    color: #ffffff;
  }

  .input-group input, .input-group select {
    border-radius: 10px;
  }

  .btn-primary {
    border-radius: 10px;
    background-color: #3b82f6;
    border: none;
    transition: background-color 0.2s ease-in-out;
  }

  .btn-primary:hover {
    background-color: #2563eb;
  }

  /* Animations */
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateX(50px); }
    to { opacity: 1; transform: translateX(0); }
  }

</style>

<!-- Main Container -->
<div class="container my-5">

  <!-- Original Document -->
  <h2 class="section-title">üìÑ Original Document</h2>
  <div class="scroll-box mb-4">
    <pre>{{ original }}</pre>
  </div>

  <!-- Simplified Version -->
  <h2 class="section-title">‚úÖ Simplified Version ({{ chosen_language|title }})</h2>
  <div class="card-box mb-5">
    {{ simplified|safe }}
  </div>

  <!-- Chat Section -->
  <h2 class="section-title">ü§ñ Ask Questions About This Document</h2>

  <!-- Chatbox Display -->
  <div id="chatbox" class="mb-3"></div>

  <!-- Language + Input -->
  <div class="input-group mb-4">
    <span class="input-group-text">üåê</span>
    <select id="chatLanguage" class="form-select" style="max-width: 160px;">
      <option value="auto" selected>Auto</option>
      <option value="en">English</option>
      <option value="hi">Hindi</option>
    </select>
    <input type="text" id="userInput" class="form-control" placeholder="üí¨ Ask your question here...">
    <button class="btn btn-primary" onclick="askQuestion()">Ask üöÄ</button>
  </div>

  <!-- Upload New Document -->
  <div class="text-end">
    <a href="/" class="btn btn-outline-secondary">‚¨ÖÔ∏è Upload Another Document</a>
  </div>
</div>

<!-- Chat Script -->
<script>
  async function askQuestion() {
    const input = document.getElementById("userInput").value.trim();
    const chatLang = document.getElementById("chatLanguage").value;
    const chatbox = document.getElementById("chatbox");

    if (!input) return;

    // Display user question
    chatbox.innerHTML += `<div class="user-msg"><b>üë§ You:</b> ${input}</div>`;
    chatbox.innerHTML += `<div id="thinking" class="thinking-msg">ü§ñ AI is thinking...</div>`;
    chatbox.scrollTop = chatbox.scrollHeight;

    try {
      const res = await fetch("/ask", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ question: input, chat_language: chatLang })
      });

      const data = await res.json();

      // Remove thinking indicator
      document.getElementById("thinking").remove();

      // Display AI response
      chatbox.innerHTML += `<div class="ai-msg"><b>ü§ñ AI:</b> ${data.answer}</div>`;
    } catch (err) {
      const thinkingEl = document.getElementById("thinking");
      if (thinkingEl) thinkingEl.remove();
      chatbox.innerHTML += `<div class="error-msg"><b>‚ùå Error:</b> ${err}</div>`;
    }

    // Reset input
    document.getElementById("userInput").value = "";
    chatbox.scrollTop = chatbox.scrollHeight;
  }

  // Send on Enter key
  document.getElementById("userInput").addEventListener("keypress", function(e) {
    if (e.key === "Enter") {
      askQuestion();
      e.preventDefault();
    }
  });
</script>

{% endblock %}

